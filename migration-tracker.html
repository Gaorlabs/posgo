<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PosGo! SaaS Migration Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Outfit', 'sans-serif'] },
            colors: {
              brand: { 500: '#6366f1', 600: '#4f46e5' },
              gaor: { primary: '#6366f1', accent: '#8b5cf6' }
            },
            animation: {
                'fade-in': 'fadeIn 0.5s ease-out',
                'slide-up': 'slideUp 0.5s ease-out forwards'
            },
            keyframes: {
                fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
            }
          }
        }
      }
    </script>
    <style>
        body { background-color: #f8fafc; }
        .checkbox-wrapper input:checked + div {
            background-color: #10b981;
            border-color: #10b981;
        }
        .checkbox-wrapper input:checked + div svg {
            display: block;
        }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <div class="bg-white border-b border-slate-200 z-10 shadow-sm">
        <div class="max-w-5xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-indigo-500 to-violet-600 text-white p-2.5 rounded-xl shadow-lg shadow-indigo-200">
                    <i data-lucide="rocket" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="font-black text-xl text-slate-800 tracking-tight">PosGo! <span class="text-indigo-600">SaaS Migration</span></h1>
                    <p class="text-xs text-slate-500 font-medium">Hoja de Ruta Técnica</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Progreso General</div>
                <div class="flex items-center gap-3">
                    <div class="w-48 h-3 bg-slate-100 rounded-full overflow-hidden">
                        <div id="global-progress" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 w-0 transition-all duration-700 ease-out rounded-full"></div>
                    </div>
                    <span id="global-percentage" class="font-black text-indigo-600">0%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-y-auto custom-scrollbar p-6">
        <div class="max-w-5xl mx-auto space-y-8 pb-20" id="phases-container">
            <!-- Phases will be injected here -->
        </div>
    </div>

    <script>
        const phasesData = [
            {
                id: 0,
                title: "FASE 0: Los Cimientos",
                subtitle: "Supabase & Arquitectura de Datos",
                icon: "database",
                color: "indigo",
                items: [
                    { id: "0-1", text: "Crear Proyecto en Supabase (Cuenta Free)", done: false },
                    { id: "0-2", text: "Diseñar Esquema SQL (Tablas: stores, profiles, transactions, etc.)", done: false },
                    { id: "0-3", text: "Configurar RLS (Row Level Security) para aislamiento de datos", done: false },
                    { id: "0-4", text: "Conectar Frontend: Instalar @supabase/supabase-js", done: false }
                ]
            },
            {
                id: 1,
                title: "FASE 1: La Puerta de Entrada",
                subtitle: "Autenticación WhatsApp & Login",
                icon: "lock",
                color: "violet",
                items: [
                    { id: "1-1", text: "Crear AuthContext (Provider Global)", done: false },
                    { id: "1-2", text: "Diseñar Pantalla Login (Passwordless / Phone)", done: false },
                    { id: "1-3", text: "Lógica: Detectar si es Login (Existe) o Registro (Nuevo)", done: false },
                    { id: "1-4", text: "Implementar 'Backdoor' para Super Admin (4 clicks)", done: false }
                ]
            },
            {
                id: 2,
                title: "FASE 2: El Onboarding",
                subtitle: "Configuración obligatoria del negocio",
                icon: "flag",
                color: "pink",
                items: [
                    { id: "2-1", text: "Crear Componente 'OnboardingWizard'", done: false },
                    { id: "2-2", text: "Paso 1: Marca (Logo & Colores)", done: false },
                    { id: "2-3", text: "Paso 2: Legal (RUC, IGV, Dirección)", done: false },
                    { id: "2-4", text: "Paso 3: Métodos de Cobro (Yape, Plin, Bancos)", done: false },
                    { id: "2-5", text: "Bloqueo de Navegación (Route Guard) si no completó setup", done: false }
                ]
            },
            {
                id: 3,
                title: "FASE 3: Migración de Datos",
                subtitle: "De LocalStorage a la Nube",
                icon: "server",
                color: "emerald",
                items: [
                    { id: "3-1", text: "Refactorizar storageService a dataService (Supabase)", done: false },
                    { id: "3-2", text: "Inyección automática de store_id en inserts/selects", done: false },
                    { id: "3-3", text: "Manejo de estados de carga (Loading Spinners)", done: false },
                    { id: "3-4", text: "Validación de permisos por Tenant", done: false }
                ]
            },
            {
                id: 4,
                title: "FASE 4: Modo Dios",
                subtitle: "Dashboard de Super Admin",
                icon: "shield",
                color: "rose",
                items: [
                    { id: "4-1", text: "Crear AdminLayout (Interfaz separada)", done: false },
                    { id: "4-2", text: "Vista 'Negocios': Tabla de Clientes y Estado", done: false },
                    { id: "4-3", text: "Vista 'Métricas': Ingresos MRR y Usuarios Totales", done: false },
                    { id: "4-4", text: "Acciones: Botón para renovar suscripción / Banear", done: false }
                ]
            }
        ];

        // Load state from local storage
        const savedState = JSON.parse(localStorage.getItem('posgo_migration_state') || '{}');
        
        // Merge saved state
        phasesData.forEach(phase => {
            phase.items.forEach(item => {
                if (savedState[item.id]) {
                    item.done = true;
                }
            });
        });

        function render() {
            const container = document.getElementById('phases-container');
            container.innerHTML = '';
            
            let totalItems = 0;
            let completedItems = 0;

            phasesData.forEach((phase, index) => {
                const phaseCompleted = phase.items.every(i => i.done);
                const phaseProgress = phase.items.filter(i => i.done).length;
                const phaseTotal = phase.items.length;
                
                totalItems += phaseTotal;
                completedItems += phaseProgress;

                const card = document.createElement('div');
                card.className = `bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden animate-slide-up hover:shadow-md transition-shadow duration-300`;
                card.style.animationDelay = `${index * 100}ms`;
                
                let iconBg, iconColor, barColor;
                
                if (phase.color === 'indigo') { iconBg = 'bg-indigo-50'; iconColor = 'text-indigo-600'; barColor = 'bg-indigo-500'; }
                else if (phase.color === 'violet') { iconBg = 'bg-violet-50'; iconColor = 'text-violet-600'; barColor = 'bg-violet-500'; }
                else if (phase.color === 'pink') { iconBg = 'bg-pink-50'; iconColor = 'text-pink-600'; barColor = 'bg-pink-500'; }
                else if (phase.color === 'emerald') { iconBg = 'bg-emerald-50'; iconColor = 'text-emerald-600'; barColor = 'bg-emerald-500'; }
                else { iconBg = 'bg-rose-50'; iconColor = 'text-rose-600'; barColor = 'bg-rose-500'; }

                card.innerHTML = `
                    <div class="p-6 border-b border-slate-50 flex justify-between items-center bg-white">
                        <div class="flex items-center gap-4">
                            <div class="p-3 ${iconBg} ${iconColor} rounded-2xl">
                                <i data-lucide="${phase.icon}" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h2 class="font-bold text-lg text-slate-800">${phase.title}</h2>
                                <p class="text-sm text-slate-500 font-medium">${phase.subtitle}</p>
                            </div>
                        </div>
                        <div class="text-right">
                             <span class="text-xs font-bold px-3 py-1 rounded-full ${phaseCompleted ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-500'}">
                                ${phaseCompleted ? 'COMPLETADO' : `${phaseProgress}/${phaseTotal}`}
                             </span>
                        </div>
                    </div>
                    <div class="p-6 space-y-4 bg-slate-50/50">
                        ${phase.items.map(item => `
                            <label class="checkbox-wrapper flex items-start gap-4 cursor-pointer group select-none">
                                <div class="relative flex items-center pt-0.5">
                                    <input type="checkbox" class="peer sr-only" onchange="toggleItem('${item.id}')" ${item.done ? 'checked' : ''}>
                                    <div class="w-6 h-6 border-2 border-slate-300 rounded-lg peer-focus:ring-2 peer-focus:ring-indigo-200 transition-all flex items-center justify-center bg-white group-hover:border-indigo-400">
                                        <i data-lucide="check" class="w-4 h-4 text-white hidden stroke-[3]"></i>
                                    </div>
                                </div>
                                <span class="text-sm font-medium transition-colors ${item.done ? 'text-slate-400 line-through decoration-2 decoration-slate-300' : 'text-slate-700 group-hover:text-indigo-700'}">
                                    ${item.text}
                                </span>
                            </label>
                        `).join('')}
                    </div>
                    <div class="h-1.5 w-full bg-slate-100">
                        <div class="h-full ${barColor} transition-all duration-500" style="width: ${(phaseProgress / phaseTotal) * 100}%"></div>
                    </div>
                `;
                container.appendChild(card);
            });

            // Update Global Progress
            const globalPercent = Math.round((completedItems / totalItems) * 100);
            document.getElementById('global-progress').style.width = `${globalPercent}%`;
            document.getElementById('global-percentage').innerText = `${globalPercent}%`;

            if (globalPercent === 100) {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#6366f1', '#ec4899', '#10b981']
                });
            }

            lucide.createIcons();
        }

        function toggleItem(id) {
            phasesData.forEach(phase => {
                const item = phase.items.find(i => i.id === id);
                if (item) {
                    item.done = !item.done;
                    // Save to local storage
                    const currentSave = JSON.parse(localStorage.getItem('posgo_migration_state') || '{}');
                    if (item.done) {
                        currentSave[id] = true;
                    } else {
                        delete currentSave[id];
                    }
                    localStorage.setItem('posgo_migration_state', JSON.stringify(currentSave));
                }
            });
            render();
        }

        // Init
        render();

    </script>
</body>
</html>